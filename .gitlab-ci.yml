# Include our templates for rust and docker:
include:
  - project: 'famedly/infra/templates/ci-cd'
    ref: rust-v1
    file:
      - '/rust.yml'

# Different CI stages, that are shown as dots in the GitLab UI and
# are executed one after another
stages:
  - test
  - doc
  - publish

# Check stage for formatting, lints and test checking
cargo-check:
  # Extend from the template
  extends: .cargo_check
  # Overwrite the script.
  # Optional, remove if not needed
  script:
    # Run these commands in order, so execute a script in the repository first
    - bash tests/setup.sh
    # Run the script that was in the template, that we overwrote
    - !reference [.cargo_check, script]

# Publish the crate to the crate registry (crates.io or famedly, set in Cargo.toml).
# There is also another template you could use for sub-crates in your repository.
cargo-publish:
  # just included (-> activated) from the template
  extends: .cargo_publish

# Documentation pages generation and deployment to the GitLab UI.
# Only runs on the main branch.
pages:
  # just included (-> activated) from the template
  extends: .cargo_doc
